<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Autobuses</title>
    <link rel="stylesheet" href="../estilos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="header">
        <img src="../img/ADO-Autobuses-de-Oriente-Logo-700x394.png" alt="ADO Logo">
        <div class="nav-links">
          <a href="index1.html">Inicio</a>
          <a href="../index.html" id="logoutButton" name="logoutButton" class="logout-button">Cerrar Sesión</a>
        </div>  
    </div>

    <main class="main">
        <section class="bus-list">
            <h2 class="bus-list__title">Lista de Autobuses</h2>
            <!--button class="bus-list__button bus-list__button--edit" onclick="location.href='Agregar_bus.html'">Agregar Autobús</-button-->
            <table class="user-table__data">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Número de Autobús</th>
                        <th>Línea</th>
                        <th>Capacidad</th>
                        <th>Servicios</th>
                        <th>Incidencias</th>
                    </tr>
                </thead>
                <tbody id="busTableBody">
                    <!-- Los datos de los autobuses se insertarán aquí dinámicamente -->
                </tbody>
            </table>
        </section>
    </main>
</body>
<script>
    // Función para obtener y mostrar los autobuses
    async function fetchAutobuses() {
        const token = localStorage.getItem('token'); // Obtener el token del localStorage

        if (!token) {
            console.error('No se encontró un token en el localStorage.');
            return;
        }

        try {
            const response = await fetch('http://127.0.0.1:8000/api/autobus/view', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ token: token }), // Enviar el token en el cuerpo de la solicitud
            });

            if (!response.ok) {
                throw new Error(`Error en la solicitud: ${response.statusText}`);
            }

            const data = await response.json();
            const autobuses = data.autobuses;

            // Obtener el cuerpo de la tabla
            const tableBody = document.getElementById('busTableBody');
            tableBody.innerHTML = ''; // Limpiar contenido previo

            // Iterar sobre los autobuses y agregarlos a la tabla
            autobuses.forEach(autobus => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${autobus.id}</td>
                    <td>${autobus.numero_autobus}</td>
                    <td>${autobus.linea}</td>
                    <td>${autobus.capacidad}</td>
                    <td>${autobus.servicios}</td>
                    <td>${autobus.num_incidencia}</td>

                `;

                tableBody.appendChild(row);
            });
        } catch (error) {
            console.error('Error al realizar la solicitud:', error);
        }
    }

    // Llamar a la función para cargar los autobuses al cargar la página
    document.addEventListener('DOMContentLoaded', fetchAutobuses);
</script>
</html>