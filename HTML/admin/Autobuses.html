<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Autobuses</title>
    <link rel="stylesheet" href="../estilos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>
  <body>
    <div class="header">
        <img src="../img/ADO-Autobuses-de-Oriente-Logo-700x394.png" alt="ADO Logo">
        <div class="nav-links">
          <a href="index1.html">Inicio</a>
          <a href="../index.html" id="logoutButton" name="logoutButton" class="logout-button">Cerrar Sesión</a>
        </div>  
    </div>

    <main class="main">
        <section class="bus-list">
            <h2 class="bus-list__title">Lista de Autobuses</h2>
            <button class="bus-list__button bus-list__button--edit" onclick="location.href='Agregar_bus.html'">Agregar Autobús</button>
            <table class="user-table__data">
                <!--thead>
                    <tr>
                        <th>Id</th>
                        <th>a</th>
                        <th>a</th>
                        <th>a</th>
                        <th>Ta</th>
                        <th>Autobus</th>
                        <th>Estatus</th>
                    </tr>
                </thead!-->
            <table class="user-table__data">
            <ul class="bus-list__items">
            <ul class="bus-list__items">
                <li class="bus-list__item">
                    <div class="bus-list__details">
                        <i class="fas fa-bus bus-list__icon"></i>
                        <span class="bus-list__number">Autobús #123</span>
                        <span class="bus-list__line">Línea: ADO GL</span>
                    </div>
                    <div class="bus-list__actions">
                        <button class="bus-list__button bus-list__button--edit">Editar</button>
                        <button class="bus-list__button bus-list__button--delete">Eliminar</button>
                    </div>
                </li>
                <li class="bus-list__item">
                    <div class="bus-list__details">
                        
                    </div>
                    <div class="bus-list__actions">
                        <button class="bus-list__button bus-list__button--edit">Editar</button>
                        <button class="bus-list__button bus-list__button--delete">Eliminar</button>
                    </div>
                </li>
             
                  
            </ul>
        </section>
    </main>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('token');
    const busList = document.querySelector('.bus-list__items');
    
    // Limpiar lista existente
    busList.innerHTML = '';

    fetch("http://tu-api.com/api/autobuses/lista", {
        method: "GET",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
        }
    })
    .then(response => {
        if (!response.ok) throw new Error('Error al cargar autobuses');
        return response.json();
    })
    .then(data => {
        if (data.length === 0) {
            busList.innerHTML = '<li class="bus-list__item">No hay autobuses registrados</li>';
            return;
        }

        data.forEach(autobus => {
            const busItem = document.createElement('li');
            busItem.className = 'bus-list__item';
            busItem.innerHTML = `
                <div class="bus-list__details">
                    <i class="fas fa-bus bus-list__icon"></i>
                    <span class="bus-list__number">Autobús #${autobus.numero}</span>
                    <span class="bus-list__line">Línea: ${autobus.linea}</span>
                    <span class="bus-list__status">Estado: ${autobus.estado === 'ACTIVO' ? '✅ Activo' : '❌ Inactivo'}</span>
                </div>
                <div class="bus-list__actions">
                    <button class="bus-list__button bus-list__button--edit" onclick="editarAutobus('${autobus.id}')">
                        Editar
                    </button>
                    <button class="bus-list__button bus-list__button--delete" onclick="eliminarAutobus('${autobus.id}')">
                        Eliminar
                    </button>
                </div>
            `;
            busList.appendChild(busItem);
        });
    })
    .catch(error => {
        console.error("Error:", error);
        busList.innerHTML = '<li class="bus-list__item">Error al cargar la lista de autobuses</li>';
    });
});

function editarAutobus(id) {
    localStorage.setItem('autobusId', id);
    window.location.href = 'editar_bus.html';
}

function eliminarAutobus(id) {
    const token = localStorage.getItem('token');
    
    if (!confirm(`¿Estás seguro de eliminar el autobús #${id}?`)) {
        return;
    }

    fetch(`http://127.0.0.1:8000/api/autobuses/${id}`, {
        method: "DELETE",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
        }
    })
    .then(response => {
        if (!response.ok) throw new Error('Error al eliminar autobús');
        alert('Autobús eliminado exitosamente');
        location.reload(); // Recargar la lista
    })
    .catch(error => {
        console.error("Error:", error);
        alert('Error al eliminar el autobús: ' + error.message);
    });
}
</script>

</html>